= SonarQube

SonarQube is a tool used for *static code analysis*. Static code analysis is validating code as-written against industry standard practices.  It will help you find best practice violations and potential security vulnerabilities.

Organizations can define Quality Profiles which are custom rule profiles that projects must use.  Quality Gates are then rules defining the organizational policies for code quality. SDP will, by default, fail the build if the Quality Gate fails.

==  Steps Contributed

.Steps
|===
| Step | Description

| ``static_code_analysis()``
| Leverages the sonar-scanner cli to perform static code analysis and sends results to the configured SonarQube server

|===

== Library Configuration Options

.SonarQube Library Configuration Options
|===
| Field | Description | Default Value

| `credential_id`
| The Jenkins credential ID to use when authenticating to SonarQube.  Can either a valid username/password or an API Token stored in a Secret Text credential type. 
| "sonarqube"

| `wait_for_quality_gate`
| Whether or not to wait for SonarQube to send a webhook back to Jenkins notifying with the Quality Gate result
| true 

| `enforce_quality_gate`
| Determine whether the build will fail if the code does not pass the quality gate
| true

| `installation_name`
| The name of the SonarQube installation configured in `Manage Jenkins > Configure System`
| "SonarQube"

| `stage_display_name`
| Purely aesthetic.  The name of the stage block during analysis for pipeline visualization in the Jenkins console.
| "SonarQube Analysis"

| `timeout_duration`
| The number representing how long to wait for the Quality Gate response before timing out
| 1

| `timeout_unit`
| One of [ "NANOSECONDS", "MICROSECONDS", "MILLISECONDS", "SECONDS", "MINUTES", "HOURS", "DAYS" ]
| "HOURS" 

| `cli_parameters`
a| a list of additional CLI analysis parameters to pass the `sonar-scanner` cli.

for example: 

[source, groovy]
----
libraries{
    sonarqube{
        cli_parameters = [ "-Dsonar.java.binaries=empty" ]
    }
}
----

| []

| `unstash`
| a list of pre-existing stashes to try to unstash. Useful if a previous step creates compiled classes or test results for SonarQube to inspect. 
| [] 

|===

== Sonar Scanner Configurations

Extra configuration options are available by leveraging SonarQube's https://docs.sonarqube.org/display/SONAR/Analysis+Parameters[sonar-project.properties] file. the sonar-project.properties file should be added to root of the source repositoy.

==  External Dependencies

* SonarQube must already be deployed. Reference the deployment script for SDP.
* Jenkins must have a credential to access SonarQube, this is done by default when using the deployment script.
* The SonarQube URL must be configured in `Manage Jenkins > Configure System`

==  Troubleshooting

==  FAQ
